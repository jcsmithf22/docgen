<% provide :title, "Home" %>

<%= render 'shared/sidebar' %>

<div class="sm:ml-64">

  <% unless Current.user.verified %>
    <%= render "shared/notice", message: "Please verify your email" %>
  <% end %>

  <%= render "shared/bar", organization: @organization.name, page: "Dashboard" %>

  <div class="p-8">
    <h2 class="font-medium text-zinc-900">Last Updated</h2>
    <% if @recent_reports.empty? %>
      <p>No recent reports available.</p>
    <% else %>
      <ul role="list" class="mt-3 grid grid-cols-1 gap-5 md:grid-cols-2 sm:gap-6 xl:grid-cols-4">
        <% @recent_reports.each do |report| %>
          <li class="col-span-1 flex rounded-md shadow-sm">
            <div class="flex w-16 flex-shrink-0 items-center justify-center bg-pink-600 rounded-l-md text-sm font-medium text-white">GA</div>
            <div class="flex flex-1 items-center justify-between rounded-r-md border-b border-r border-t border-zinc-200 bg-white">
              <div class="flex-1 truncate px-4 py-2 text-sm">
                <%= link_to report_build_path(report_id: report.id, id: :general), class: "font-medium text-zinc-900 hover:text-zinc-600" do %>
                  <%= report.title %>
                <% end %>
                <p class="text-zinc-500"><%= report.status %></p>
              </div>
              <div data-controller="dropdown" class="flex-shrink-0 pr-2 relative inline-block">
                <button
                  type="button"
                  data-action="dropdown#toggle click@window->dropdown#hide"
                  class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-transparent bg-white text-zinc-400 hover:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                  aria-expanded="true"
                  aria-haspopup="true"
                >
                  <span class="sr-only">Open options</span>
                  <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path d="M10 3a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM10 8.5a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM11.5 15.5a1.5 1.5 0 10-3 0 1.5 1.5 0 003 0z"/>
                  </svg>
                </button>

                <div
                  data-dropdown-target="menu"
                  class="hidden transition transform origin-top-center absolute right-0 rounded-md bg-white z-10 mt-2 w-32 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
                  role="menu"
                  aria-orientation="vertical"
                  tabindex="-1"
                  data-transition-enter-from="opacity-0 scale-95"
                  data-transition-enter-to="opacity-100 scale-100"
                  data-transition-leave-from="opacity-100 scale-100"
                  data-transition-leave-to="opacity-0 scale-95"
                >
                  <div class="my-1">
                    <%= link_to "Edit", report_build_path(report_id: report.id, id: :general), class: "w-full text-start text-zinc-700 block px-4 py-2 text-sm hover:bg-zinc-100 hover:text-zinc-900", role: "menuitem", tabindex: "-1" %>
                    <%= button_to "Delete", report_path(id: report.id), method: :delete, class: "w-full text-start text-zinc-700 block px-4 py-2 text-sm hover:bg-zinc-100 hover:text-zinc-900", role: "menuitem", tabindex: "-1" %>
                  </div>
                </div>
              </div>
            </div>
          </li>
        <% end %>
      </ul>
    <% end %>
  </div>


  <p>Verified: <%= Current.user.verified %></p>


  <% if Current.user.admin? %>

    <h2 class="font-medium text-lg">Admin section</h2>

    <div class="flex flex-col w-fit items-start">
      <%= link_to "Invite user", new_invitation_path %>
      <%= link_to "Manage users", users_path %>
      <%= link_to "Manage invites", invitations_path %>
    </div>

  <% end %>

  <h2 class="font-medium text-lg">Login and verification</h2>

  <div>
    <%= link_to "Change password", edit_password_path %>
  </div>

  <div>
    <%= link_to "Change email address", edit_identity_email_path %>
  </div>

  <h2 class="font-medium text-lg">Access history</h2>

  <div>
    <%= link_to "Devices & Sessions", sessions_path %>
  </div>

  <br>

  <%= button_to "Log out", Current.session, method: :delete %>
</div>